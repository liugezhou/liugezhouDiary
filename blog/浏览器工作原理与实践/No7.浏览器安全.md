### No7.浏览器安全

<!--more-->

#### 32 | 同源策略：为什么XMLHttpRequest不能跨域请求资源？
---
> 浏览器安全可以分为三大块--Web页面安全、浏览器网络安全、浏览器系统安全。   
> 本节来分析页面中的安全策略。  
>
> 在没有安全保障的 Web 世界中，我们是没有隐私的，因此需要安全策略来保障我们的隐私和数据的安全。这就引出了页面中最基础、最核心的安全策略：`同源策略（Same-origin policy）`。

##### 什么是同源策略
---
> 如果两个 URL 的协议、域名和端口都相同，我们就称这两个 URL 同源.   
> 浏览器默认两个相同的源之间是可以相互访问资源和操作 DOM 的。两个不同的源之间若想要相互访问资源或者操作 DOM，那么会有一套基础的安全策略的制约，我们把这称为同源策略。   
> 具体来讲，同源策略主要表现在 DOM、Web 数据和网络这三个层面。  
> + 第一个：DOM层面。同源策略限制了来自不同源的 JavaScript 脚本对当前 DOM 对象读和写的操作。    
> + 第二个：数据层面。同源策略限制了不同源的站点读取当前站点的 Cookie、IndexDB、LocalStorage 等数据。   
> + 第三个，网络层面。同源策略限制了通过 XMLHttpRequest 等方式将站点的数据发送给不同源的站点。

##### 安全和便利性的权衡
---
> 浏览器出让了同源策略的一些安全性。    
###### 1. 页面中可以嵌入第三方资源
> 页面中可以嵌入第三方资源，但是却有可能嵌入的是恶意代码，恶意读取Cookie等数据，于是浏览器中引入了内容安全策略，称为CSP。   
> CSP 的核心思想是让服务器决定浏览器能够加载哪些资源，让服务器决定浏览器是否能够执行内联 JavaScript 代码。

###### 2. 跨域资源共享和跨文档消息机制
> 为了解决不同源的资源不能共享问题，引入了`跨域资源共享(CORS)`，使用该机制可以进行跨域访问控制，从而使跨域数据传输得以安全进行。    
> 在介绍同源策略时，我们说明了如果两个页面不是同源的，则无法相互操纵 DOM。不过在实际应用中，经常需要两个不同源的 DOM 之间进行通信，于是浏览器中又引入了跨文档消息机制，可以通过 window.postMessage 的 JavaScript 接口来和不同源的 DOM 进行通信。    

#### 33 | 跨站脚本攻击(XSS):为什么Cookie中有HttpOnly属性？
---
> 通过上一节我们知道：同源策略可以隔离各个站点之间的 DOM 交互、页面数据和网络通信，虽然严格的同源策略会带来更多的安全，但是也束缚了 Web。这就需要在安全和自由之间找到一个平衡点，所以我们默认页面中可以引用任意第三方资源，然后又引入 CSP 策略来加以限制；默认 XMLHttpRequest 和 Fetch 不能跨站请求资源，然后又通过 CORS 策略来支持其跨域。不过支持页面中的第三方资源引用和 CORS 也带来了很多安全问题，其中最典型的就是 XSS 攻击。  

##### 什么是XSS攻击
> XSS 全称是 Cross Site Scripting，为了与“CSS”区分开来，故简称 XSS，翻译过来就是“跨站脚本”。XSS 攻击是指黑客往 HTML 文件中或者 DOM 中注入恶意脚本，从而在用户浏览页面时利用注入的恶意脚本对用户实施攻击的一种手段。
> 恶意脚本可以做哪些事情呢？    
> + 可以获取Cookie消息。    
> + 可以监听用户行为。  
> + 可以通过修改DOM伪造假的登录窗口，用来欺骗用户输入用户名和密码等信息。   
> + 还可以在页面内生成浮窗广告。    

##### 恶意脚本是怎么注入的
> 常见的注入方式有：存储型XSS攻击、反射型XSS攻击、基于DOM的XSS攻击。    

##### 如何阻止XSS攻击
> 1. 服务器对输入脚本进行过滤或转码。   
> 2. 充分利用CSP。  
> 3. 使用 HttpOnly 属性。   